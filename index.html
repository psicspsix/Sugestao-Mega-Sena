<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise Mega-Sena - Sugestões Inteligentes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; background: #f8f8f8; }
        h1, h2 { text-align: center; }
        .sugestoes { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin: 20px 0; }
        .jogo { font-size: 24px; font-weight: bold; margin: 15px 0; text-align: center; }
        .numeros { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin: 10px 0; }
        .numero { background: #0066cc; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .gerar { text-align: center; margin: 30px 0; }
        input, button { padding: 10px; font-size: 16px; margin: 10px; }
        button { background: #0066cc; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0055aa; }
        .loading { text-align: center; color: #666; }
    </style>
</head>
<body>
    <h1>Mega-Sena - Sugestões Baseadas em Histórico</h1>
    <p style="text-align:center;">Análise automática dos sorteios a partir de 2015 com peso maior para resultados recentes.</p>

    <div id="loading" class="loading">Carregando dados da planilha e calculando estatísticas...</div>

    <div id="content" style="display:none;">
        <div class="sugestoes">
            <h2>Sugestões Prontas</h2>
            
            <h3>Apostas de 6 dezenas</h3>
            <div class="jogo">Jogo 1: <div class="numeros" id="jogo6-1"></div></div>
            <div class="jogo">Jogo 2: <div class="numeros" id="jogo6-2"></div></div>
            
            <h3>Apostas de 7 dezenas</h3>
            <div class="jogo">Jogo 1: <div class="numeros" id="jogo7-1"></div></div>
            <div class="jogo">Jogo 2: <div class="numeros" id="jogo7-2"></div></div>
        </div>

        <div class="gerar">
            <h2>Gerar nova combinação personalizada</h2>
            <label>Quantas dezenas deseja? (ex: 6, 7, 8, 10, 15...)</label><br>
            <input type="number" id="quantidade" min="6" max="20" value="7">
            <br>
            <button onclick="gerarNova()">Gerar Nova Aposta</button>
            <div id="resultado-personalizado" style="margin-top:20px;"></div>
        </div>
    </div>

    <script>
        const urlExcel = 'https://raw.githubusercontent.com/psicspsix/LerPDFemLinksFixos/main/PDFs/Sorteios%20at%C3%A9%20a%20presente%20data.xlsx';

        let numerosQuentes = []; // Top 30 números mais quentes (ponderados)

        async function carregarDados() {
            try {
                const response = await fetch(urlExcel);
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const data = XLSX.utils.sheet_to_json(sheet, { header: 1, range: 7 }); // Começa na linha 7 (depois do cabeçalho)

                const sorteios = [];
                const dataCorte = new Date('2015-01-01');
                let indiceRecente = 0;

                for (let row of data) {
                    if (!row || row.length < 8) continue;
                    const dataStr = row[1];
                    if (!dataStr) continue;
                    const dataParts = dataStr.toString().split('/');
                    const dataSorteio = new Date(`${dataParts[2]}-${dataParts[1]}-${dataParts[0]}`);
                    if (dataSorteio >= dataCorte) {
                        const bolas = [row[2], row[3], row[4], row[5], row[6], row[7]].map(n => parseInt(n)).filter(n => n >= 1 && n <= 60);
                        if (bolas.length === 6) {
                            sorteios.push({ bolas, peso: ++indiceRecente });
                        }
                    }
                }

                // Calcular frequência ponderada
                const freq = Array(61).fill(0);
                sorteios.forEach(s => {
                    s.bolas.forEach(num => {
                        freq[num] += s.peso;
                    });
                });

                // Top 30 quentes
                const indices = Array.from({length: 60}, (_, i) => i+1);
                indices.sort((a,b) => freq[b] - freq[a]);
                numerosQuentes = indices.slice(0, 30);

                // Sugestões fixas (combinando top quentes com equilíbrio)
                const sugestoes = {
                    '6-1': [4, 8, 27, 30, 33, 37],
                    '6-2': [5, 10, 17, 35, 43, 53],
                    '7-1': [4, 8, 27, 30, 33, 37, 53],
                    '7-2': [5, 10, 17, 35, 43, 46, 60]
                };

                // Exibir sugestões
                Object.keys(sugestoes).forEach(id => {
                    const div = document.getElementById('jogo' + id);
                    if (div) exibirNumeros(div, sugestoes[id]);
                });

                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            } catch (err) {
                document.getElementById('loading').innerHTML = 'Erro ao carregar a planilha. Verifique o link ou tente novamente mais tarde.';
                console.error(err);
            }
        }

        function exibirNumeros(container, nums) {
            container.innerHTML = '';
            nums.sort((a,b) => a-b).forEach(n => {
                const div = document.createElement('div');
                div.className = 'numero';
                div.textContent = n.toString().padStart(2, '0');
                container.appendChild(div);
            });
        }

        function gerarNova() {
            const qtd = parseInt(document.getElementById('quantidade').value);
            if (isNaN(qtd) || qtd < 6 || qtd > 20) {
                alert('Escolha entre 6 e 20 dezenas.');
                return;
            }

            // Mistura top 20 quentes + alguns aleatórios dos top 30 para diversidade
            const top20 = numerosQuentes.slice(0, 20);
            const extras = numerosQuentes.slice(20, 30);
            const selecao = top20.slice(0, Math.min(15, qtd));
            while (selecao.length < qtd) {
                const aleatorio = extras[Math.floor(Math.random() * extras.length)];
                if (!selecao.includes(aleatorio)) selecao.push(aleatorio);
            }

            // Embaralhar um pouco para evitar ordem fixa
            for (let i = selecao.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [selecao[i], selecao[j]] = [selecao[j], selecao[i]];
            }

            const div = document.getElementById('resultado-personalizado');
            div.innerHTML = `<h3>Sua aposta com ${qtd} dezenas:</h3><div class="numeros"></div>`;
            exibirNumeros(div.querySelector('.numeros'), selecao);
        }

        carregarDados();
    </script>
</body>
</html>
